<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Cotizador</title>
        <script src="./actions/selection.js"></script>
        <script src="./actions/send.js"></script>

</head>
<style>
        form {
                opacity: 0;
                transform: translateY(40px) scale(0.98);
                animation: fadeInUp 0.8s cubic-bezier(.4, 0, .2, 1) forwards;
        }

        @keyframes fadeInUp {
                to {
                        opacity: 1;
                        transform: translateY(0) scale(1);
                }
        }
</style>

<body class="bg-[#E7F5FE] min-h-screen flex items-center justify-center">
        <main class="mx-auto mt-12 text-center  w-full">
                <div class="flex flex-col items-center mb-8">
                        <img class=" mb-4" src="./assets/Recurso-4.png" alt="Logo SmartDesign">

                </div>

                <form method="post" action="./back/guardar.php"
                        class="fadeInUp bg-white rounded-lg max-w-[90%] shadow-md shadow-blue-200 shadow-xl p-5 space-y-6 mx-auto">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex flex-col gap-2">
                                        <label for="nombre" class="text-lg font-semibold text-gray-700">Nombre del
                                                paciente</label>
                                        <input id="nombre" name="nombre" type="text" placeholder="Ingresa tu nombre"
                                                class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition"
                                                required />
                                </div>
                                <div class="flex flex-col gap-2">
                                        <label for="fecha" class="text-lg font-semibold text-gray-700">Fecha</label>
                                        <input id="fecha" name="fecha" type="date"
                                                class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition"
                                                required />
                                </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="flex flex-col gap-2">
                                        <label for="doctor" class="text-lg font-semibold text-gray-700">Valoración
                                                realizada por el Dr</label>
                                        <select id="doctor" name="doctor"
                                                class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition"
                                                required>
                                                <option value="">Selecciona el doctor</option>
                                                <option value="Gianmarco Terry">Gianmarco Terry</option>
                                        </select>
                                </div>
                                <div class="flex flex-col gap-2">
                                        <label for="expediente" class="text-lg font-semibold text-gray-700">Expediente
                                                N<sup>o</sup></label>
                                        <input id="expediente" type="text" name="expediente"
                                                placeholder="Ingresa el número de expediente"
                                                class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition" />
                                </div>
                        </div>
                        <div class="flex flex-col gap-2">
                                <label for="correo" class="text-lg font-semibold text-gray-700">Correo
                                        Electrónico</label>
                                <input id="correo" type="email" name="correo" placeholder="Ingresa tu correo"
                                        class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition" />
                        </div>
                        <div class="flex flex-col gap-2">
                                <label for="observaciones"
                                        class="text-lg font-semibold text-gray-700">Observaciones</label>
                                <textarea id="observaciones" name="observaciones" rows="3"
                                        class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition"></textarea>
                        </div>
                        <div class="text-center text-blue-800 font-bold text-xl mb-4">
                                ODONTOGRAMA
                        </div>


                        <div class="grid grid-cols-16 gap-1 text-sm text-blue-700 text-center mb-1">
                                <!-- Dientes superiores -->
                                <span>
                                        18<br>
                                        <input type="checkbox" id="diente-18" name="diente-18">
                                </span>
                                <span>
                                        17<br>
                                        <input type="checkbox" id="diente-17" name="diente-17">
                                </span>
                                <span>
                                        16<br>
                                        <input type="checkbox" id="diente-16" name="diente-16">
                                </span>
                                <span>
                                        15<br>
                                        <input type="checkbox" id="diente-15" name="diente-15">
                                </span>
                                <span>
                                        14<br>
                                        <input type="checkbox" id="diente-14" name="diente-14">
                                </span>
                                <span>
                                        13<br>
                                        <input type="checkbox" id="diente-13" name="diente-13">
                                </span>
                                <span>
                                        12<br>
                                        <input type="checkbox" id="diente-12" name="diente-12">
                                </span>
                                <span>
                                        11<br>
                                        <input type="checkbox" id="diente-11" name="diente-11">
                                </span>
                                <span>
                                        21<br>
                                        <input type="checkbox" id="diente-21" name="diente-21">
                                </span>
                                <span>
                                        22<br>
                                        <input type="checkbox" id="diente-22" name="diente-22">
                                </span>
                                <span>
                                        23<br>
                                        <input type="checkbox" id="diente-23" name="diente-23">
                                </span>
                                <span>
                                        24<br>
                                        <input type="checkbox" id="diente-24" name="diente-24">
                                </span>
                                <span>
                                        25<br>
                                        <input type="checkbox" id="diente-25" name="diente-25">
                                </span>
                                <span>
                                        26<br>
                                        <input type="checkbox" id="diente-26" name="diente-26">
                                </span>
                                <span>
                                        27<br>
                                        <input type="checkbox" id="diente-27" name="diente-27">
                                </span>
                                <span>
                                        28<br>
                                        <input type="checkbox" id="diente-28" name="diente-28">
                                </span>
                        </div>
                        <div id="odontograma-superior" class="grid grid-cols-16 gap-1 mb-4"></div>
                        <script>
                                fetch('./actions/odontograma.json')
                                        .then(response => response.json())
                                        .then(data => {
                                                const container = document.getElementById('odontograma-superior');
                                                if (data.odontograma_superior) {
                                                        data.odontograma_superior.forEach(src => {
                                                                const div = document.createElement('div');
                                                                div.className = "aspect-square border-2 border-blue-500 rounded flex items-center justify-center";
                                                                div.innerHTML = `<img src="${src}" alt="Diente" class="h-8" />`;
                                                                container.appendChild(div);
                                                        });
                                                }
                                        })
                                        .catch(error => {
                                                console.error('Error cargando el odontograma superior:', error);
                                        });
                        </script>

                        <div class="grid grid-cols-16 gap-1 text-sm text-blue-700 text-center mb-1">
                                <span>
                                        48<br>
                                        <input type="checkbox" id="diente-48" name="diente-48">
                                </span>
                                <span>
                                        47<br>
                                        <input type="checkbox" id="diente-47" name="diente-47">
                                </span>
                                <span>
                                        46<br>
                                        <input type="checkbox" id="diente-46" name="diente-46">
                                </span>
                                <span>
                                        45<br>
                                        <input type="checkbox" id="diente-45" name="diente-45">
                                </span>
                                <span>
                                        44<br>
                                        <input type="checkbox" id="diente-44" name="diente-44">
                                </span>
                                <span>
                                        43<br>
                                        <input type="checkbox" id="diente-43" name="diente-43">
                                </span>
                                <span>
                                        42<br>
                                        <input type="checkbox" id="diente-42" name="diente-42">
                                </span>
                                <span>
                                        41<br>
                                        <input type="checkbox" id="diente-41" name="diente-41">
                                </span>
                                <span>
                                        31<br>
                                        <input type="checkbox" id="diente-31" name="diente-31">
                                </span>
                                <span>
                                        32<br>
                                        <input type="checkbox" id="diente-32" name="diente-32">
                                </span>
                                <span>
                                        33<br>
                                        <input type="checkbox" id="diente-33" name="diente-33">
                                </span>
                                <span>
                                        34<br>
                                        <input type="checkbox" id="diente-34" name="diente-34">
                                </span>
                                <span>
                                        35<br>
                                        <input type="checkbox" id="diente-35" name="diente-35">
                                </span>
                                <span>
                                        36<br>
                                        <input type="checkbox" id="diente-36" name="diente-36">
                                </span>
                                <span>
                                        37<br>
                                        <input type="checkbox" id="diente-37" name="diente-37">
                                </span>
                                <span>
                                        38<br>
                                        <input type="checkbox" id="diente-38" name="diente-38">
                                </span>
                        </div>
                        <div id="odontograma-inferior" class="grid grid-cols-16 gap-1 mb-4"></div>

                        <script>
                                fetch('./actions/odontograma.json')
                                        .then(response => response.json())
                                        .then(data => {
                                                const container = document.getElementById('odontograma-inferior');
                                                if (data.odontograma_inferior) {
                                                        data.odontograma_inferior.forEach(src => {
                                                                const div = document.createElement('div');
                                                                div.className = "aspect-square border-2 border-blue-500 rounded flex items-center justify-center";
                                                                div.innerHTML = `<img src="${src}" alt="Diente" class="h-8" />`;
                                                                container.appendChild(div);
                                                        });
                                                }
                                        })
                                        .catch(error => {
                                                console.error('Error cargando el odontograma inferior:', error);
                                        });
                        </script>

                        <div class="text-center text-blue-800 font-bold text-xl mb-4">
                                PRESUPUESTO
                        </div>

                        <div class="flex flex-wrap items-end gap-3">
                                <div>
                                        <label for="tratamiento"
                                                class="block text-sm font-medium text-gray-700 mb-1">Selecciona un
                                                tratamiento</label>
                                        <select id="tratamiento-select" name="tratamiento"
                                                class="w-full border border-gray-300 bg-gray-100 py-2 px-2 text-sm rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                                                <option value="" selected>-- Selecciona una opción --</option>
                                        </select>
                                </div>

                                <div>
                                        <label for="precio"
                                                class="block text-sm font-medium text-gray-700 mb-1">Precio</label>
                                        <input type="number" id="precio" name="precio" placeholder="Ingresa el precio"
                                                class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition w-32" />
                                </div>

                                <div>
                                        <label for="descuento"
                                                class="block text-sm font-medium text-gray-700 mb-1">Descuento</label>
                                        <input type="number" id="descuento" name="descuento"
                                                placeholder="Ingresa el descuento"
                                                class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 transition w-32" />
                                </div>

                                <div>
                                        <button id="add-btn" type="button"
                                                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition mt-6">Agregar</button>
                                </div>
                        </div>

                        <div class="mt-4">
                                <table class="w-full text-sm border border-collapse border-gray-300 mt-4">
                                        <thead class="bg-gray-100">
                                                <tr>
                                                        <th class="border px-2 py-1">Tratamiento</th>
                                                        <th class="border px-2 py-1">Precio</th>
                                                        <th class="border px-2 py-1">Descuento</th>
                                                        <th class="border px-2 py-1">Total</th>
                                                </tr>
                                        </thead>
                                        <tbody id="tabla-tratamientos"></tbody>
                                </table>
                        </div>

                        <hr class="my-4">
                        <div class="grid grid-cols-3 text-center items-start mb-4">
                                <div>
                                        <p class="block text-sm font-medium text-gray-700 mb-1">Total:</p>
                                        <p id="total-sin-descuento" class="text-gray-800 font-bold text-lg">$0</p>
                                </div>
                                <div>
                                        <p class="block text-sm font-medium text-blue-800">Total con Descuento:</p>
                                        <p id="total-con-descuento" class="text-blue-800 font-bold text-lg">$0</p>
                                </div>
                                <div>
                                        <p class="block text-sm font-medium text-blue-800">Tipo de Descuento</p>
                                        <select id="tipo-descuento"
                                                class="w-full border border-gray-300 bg-gray-100 text-gray-700 rounded p-4 h-16 focus:outline-none">
                                                <option value="">Seleccione</option>
                                                <option value="internet">Internet</option>
                                                <option value="especial">Especial</option>
                                                <option value="facebook">Facebook</option>
                                                <option value="instagram">Instagram</option>
                                                <option value="doctora">Doctoralia</option>
                                                <option value="otro">Otro</option>
                                        </select>
                                </div>
                        </div>
                        <p class="block text-sm font-medium text-blue-800">Descuento Total: <span id="descuento-total"
                                        class="font-bold">$0</span></p>


                        <input type="hidden" name="tratamientos_json" id="tratamientos_json">

                        <script>
                                const tratamientos = [];
                                let tratamientosDisponibles = [];

                                const tratamientoSelect = document.getElementById('tratamiento-select');
                                const precioInput = document.getElementById('precio');
                                const descuentoInput = document.getElementById('descuento');
                                const addBtn = document.getElementById('add-btn');
                                const tablaBody = document.getElementById('tabla-tratamientos');

                                const totalSinDescuentoEl = document.getElementById('total-sin-descuento');
                                const totalConDescuentoEl = document.getElementById('total-con-descuento');
                                const descuentoTotalEl = document.getElementById('descuento-total');
                                const tratamientosJSON = document.getElementById('tratamientos_json');

                                fetch('../actions/tratamientos.json')
                                        .then(response => response.json())
                                        .then(data => {
                                                tratamientosDisponibles = data.tratamientos || [];

                                                tratamientosDisponibles.forEach((tratamiento, index) => {
                                                        const option = document.createElement('option');
                                                        option.value = index;
                                                        option.textContent = tratamiento;
                                                        tratamientoSelect.appendChild(option);
                                                });
                                        })
                                        .catch(error => {
                                                console.error('Error al cargar tratamientos:', error);
                                        });

                                function actualizarTabla() {
                                        tablaBody.innerHTML = '';

                                        let totalSinDescuento = 0;
                                        let totalConDescuento = 0;
                                        let descuentoTotal = 0;

                                        tratamientos.forEach(t => {
                                                const total = Math.max(t.precio - t.descuento, 0);
                                                totalSinDescuento += t.precio;
                                                totalConDescuento += total;
                                                descuentoTotal += t.descuento;

                                                const row = document.createElement('tr');
                                                row.innerHTML = `
        <td class="border px-2 py-1">${t.nombre}</td>
        <td class="border px-2 py-1">$${t.precio.toLocaleString('es-MX')}</td>
        <td class="border px-2 py-1">$${t.descuento.toLocaleString('es-MX')}</td>
        <td class="border px-2 py-1">$${total.toLocaleString('es-MX')}</td>
      `;
                                                tablaBody.appendChild(row);
                                        });

                                        totalSinDescuentoEl.textContent = totalSinDescuento.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' });
                                        totalConDescuentoEl.textContent = totalConDescuento.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' });
                                        descuentoTotalEl.textContent = descuentoTotal.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' });
                                }

                                addBtn.addEventListener('click', (event) => {
                                        event.preventDefault();

                                        const selectedIndex = tratamientoSelect.value;
                                        const nombre = tratamientosDisponibles[selectedIndex];
                                        const precio = parseFloat(precioInput.value) || 0;
                                        const descuento = parseFloat(descuentoInput.value) || 0;

                                        if (!nombre || precio <= 0) {
                                                alert('Selecciona un tratamiento válido y un precio mayor a 0.');
                                                return;
                                        }

                                        tratamientos.push({ nombre, precio, descuento });
                                        actualizarTabla();

                                        tratamientoSelect.value = '';
                                        precioInput.value = '';
                                        descuentoInput.value = '';
                                });

                                // Antes de enviar el formulario, guardar JSON en input oculto
                                document.querySelector('form').addEventListener('submit', function () {
                                        tratamientosJSON.value = JSON.stringify(tratamientos);
                                });
                        </script>


                        <div class="text-center mt-20 mb-10 text-xl font-semibold text-blue-700">
                                FORMA DE PAGO
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="flex flex-col">
                                        <label for="dia_tratamiento" class="text-blue-700 text-sm font-semibold mb-1">El
                                                día del tratamiento</label>
                                        <input type="date" id="dia_tratamiento" name="dia_tratamiento"
                                                class=" focus:outline-none focus:ring-2 focus:ring-blue-400 border border-gray-300 p-2 rounded-md w-full">
                                </div>

                                <div class="flex flex-col">
                                        <label for="inicio_tratamiento"
                                                class="focus:outline-none focus:ring-2 focus:ring-blue-400 text-blue-700 text-sm font-semibold mb-1">Al
                                                inicio del
                                                tratamiento</label>
                                        <input type="date" id="inicio_tratamiento" name="inicio_tratamiento"
                                                class="focus:outline-none focus:ring-2 focus:ring-blue-400 border border-gray-300 p-2 rounded-md w-full">
                                </div>

                                <div class="flex flex-col">
                                        <label for="antes_final_tratamiento"
                                                class="text-blue-700 text-sm font-semibold mb-1">Antes del final del
                                                tratamiento</label>
                                        <input type="date" id="antes_final_tratamiento" name="antes_final_tratamiento"
                                                class="focus:outline-none focus:ring-2 focus:ring-blue-400 border border-gray-300 p-2 rounded-md w-full">
                                </div>
                        </div>
                        <p class=" text-sm mb-6 text-blue-700">
                                <strong class="text-blue-700">Nota:</strong> Estos presupuestos son de carácter
                                informativo y pueden sufrir modificaciones por imprevistos que se presenten durante el
                                tratamiento. Todas las cantidades de este presupuesto se expresan en moneda nacional y
                                tienen una vigencia de 15 días a partir de su fecha de expedición.
                        </p>

                        <p class="text-center text-blue-600 font-bold mb-8">
                                - En ningún caso el presente presupuesto representa un recibo de pago -
                        </p>

                        <button type="submit"
                                class="focus:outline-none focus:ring-2 focus:ring-blue-400 bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors duration-200 cursor-pointer">
                                Enviar
                        </button>
                </form>
        </main>
</body>

</html>